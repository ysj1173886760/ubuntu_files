### 层级哈希

将单层哈希编码方案扩展为两级分层编码方案来增强哈希码的表现力，在该方案中，第一级哈希编码用于捕获图像的局部语义信息，而第二级则将其压缩为更具全局性的紧凑编码，然后通过分层方式组合两个级别的哈希编码，提高检索效率

一种依赖于激活图（activation map）和类激活图（class activation map, CAM）的注意力机制，该机制利用深度特征的局部和全局属性用以选择每个查询图像最重要的一些特定哈希编码位，避免使用第一级完整的哈希编码

![image-20201112204852657](/home/sheep/.config/Typora/typora-user-images/image-20201112204852657.png)

CAM最初是用于获取同某语义类别相关的判别性图像区域，并不适合用于图像检索

我们将哈希编码的每一位视为一个类别，并使用CAM来定位同每个全局层级哈希编码位相关的图像显著区域。对于局部哈希编码，采用类似方法计算CAM

![image-20201112210309828](/home/sheep/.config/Typora/typora-user-images/image-20201112210309828.png)

每一位编码对应的类激活图取平均，然后根据阈值二值化，确定关注区域

计算所有特征图的激活图，然后二值化，再根据关注区域计算重叠度

从高到低进行排序，选择前L个作为局部特征，然后选择对应的L位用于过滤被检索图像的第一级哈希编码

层次搜索策略，首先使用全局级别哈希编码进行粗检索，选出前K个，再使用局部级别哈希编码进行重新排序

### 深度编码操作哈希（Deep Code Operation Hashing, DCOH）

![image-20201112201500918](/home/sheep/.config/Typora/typora-user-images/image-20201112201500918.png)

N张图像，C个类别，D维视觉特征，学习K个哈希函数，映射成K维哈希编码

哈希编码操作符 分别为交 并 差， 对应得到的新的哈希编码的类别也是两个原始操作数类别的交 并 差

![image-20201112202213273](/home/sheep/.config/Typora/typora-user-images/image-20201112202213273.png)

关键在于得到的新的哈希编码的类别

对于差来说

![image-20201112202335857](/home/sheep/.config/Typora/typora-user-images/image-20201112202335857.png)

![image-20201112202355969](/home/sheep/.config/Typora/typora-user-images/image-20201112202355969.png)

所以差运算放到并运算后面训练

三个损失函数

- 特别相似的图像的编码应该保持一致（多层相似保持）
- 哈希码在语义空间应该是可区分的（方便在语义层级上操作哈希码）
- 编码操作网络的需求，输入和输出应该具有相同的分布（输出在输入空间中检索最近邻样本）

图中表示原始编码与生成的编码的分布

![image-20201112203323663](/home/sheep/.config/Typora/typora-user-images/image-20201112203323663.png)

传入到分类器D中，是一个学习的损失函数，对抗学习用于调整CON网络的参数