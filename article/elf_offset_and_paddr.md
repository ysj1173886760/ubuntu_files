### ELF文件中segment的offset和paddr

大家如果有看过CSAPP的第七章，应该可以记得其中有说过一个段的地址和偏移之间的关系

注意这里说的段是可执行ELF的段（segment），而不是目标文件的段（section）

其中有讲到，对于地址addr和偏移offset，以及对齐align，有这样一个关系，即`addr % algin == offset % align`

不知道大家当初刚看到这一段的时候是不是也感觉非常迷惑，到底是为什么呢？

首先明确，这里的align指的是页对齐，而不是指定的段对齐，也就是说，align的值一般就是`0x100`，即一个页的大小

然后在继续往下说之前，我们要先明白，offset在文件中其实是可以或多或少的体现出这个对应的段的大小的，所以直觉上来讲，不考虑我们的程序是从`0x8048000`开始加载的情况下，其实offset应该是和段地址相同的，因为就相当于直接将文件映射到地址空间中

但是再注意，我们不同的段是要对应不同的访问权限等若干由操作系统控制的属性的，所以不同的段是不能被放到同一个页中的。（如果可以的话，病毒就可以通过某种方式通过在数据段溢出来修改代码了）

但是随之而来的问题就是，尽管我们会将相同权限的段进行合并，也仍然会出现内存碎片导致内存利用率不高。因为段的大小不可能总是页大小的整数倍。

那么对于这种问题，要怎么解决呢？从根本上想，我们的问题是来源于多个段不能存在于同一个页中。同时要注意，我们这里说的是虚拟地址空间

这里引用程序员的自我修养中的两张图来辅助理解

